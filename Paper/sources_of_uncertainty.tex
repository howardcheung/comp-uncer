\section{Sources of uncertainty} \label{sec:sources}
\label{sec:uncer_source}

Uncertainty of the compressor map output is the range where the true value of the output may be relative to the map output. It consists of multiple components and can be grouped as follows:

\begin{itemize}
\item Uncertainty due to inputs
\item Uncertainty due to training data
\item Uncertainty due ot model random error
\item Uncertainty due to outputs
\end{itemize}

\subsection{Uncertainty due to inputs} \label{subsec:uncer_inputs}
Uncertainty due to inputs is the uncertainty propagated to the map output due to the uncertainty in the inputs to the maps. The inputs to the map (evaporating and condenser temperature) are usually obtained by converting pressure measurements to saturation temperatures with refrigerant equations of state. Therefore the estimated saturation temperature contains uncertainty from both the equation of state and the pressure measurement. The equation of state of R22 estimates saturation pressure at an uncertainty of 0.2\% \cite{Kamei:1995}. When the equation of state estimates an saturation temperature at a given pressure, this uncertainty is transformed into a component of the uncertainty of the saturation temperature as shown in

\begin{equation}
\frac{\Delta P_{sat,EOS}}{P_{sat}(T)} = 0.2\% = 0.002
\label{eq:uncer_p_eos}
\end{equation}

and

\begin{equation}
\Delta {T_{sat,EOS}} = \left|{\frac{{\partial {T_{sat}}({P})}}{{\partial {P}}}}\right|\Delta {P_{sat,EOS}} ,
\label{eq:uncer_t_eos}
\end{equation}

where $\Delta P_{sat,EOS}$ is the uncertainty of saturation pressure as a result of uncertainty of the equation of state, $P_{sat}(T)$ is the saturation pressure from temperature $T$, $\Delta {T_{sat,EOS}}$ is the uncertainty of saturation temperature as a result of uncertainty of the equation of state and ${T_{sat}}({P})$ is the saturation temperature at pressure $P$.

The component of the saturation temperature uncertainty due to pressure measurement is calculated by

\begin{equation}
\Delta {T_{sat,mea}} = \left|\frac{{\partial {T_{sat}}({P})}}{{\partial {P}}}\right|\Delta {P_{sat,mea}},
\label{eq:uncer_t_mea}
\end{equation}

where $\Delta {T_{sat,mea}}$ is the uncertainty of saturation temperature as a result of pressure measurement and $\Delta P_{sat,mea}$ is the uncertainty of pressure measurement. The overall uncertainty of the saturation temperature is given by 

\begin{equation}
\Delta {T_{sat}} = \sqrt {{{(\Delta {T_{sat,EOS}})}^2} + {{(\Delta {T_{sat,mea}})}^2}} .
\label{eq:uncer_t}
\end{equation}

The uncertainty of the map output propagated from the inputs of condensing temperature and evaporating temperature is calculated by

\begin{equation}
\Delta {\hat{\dot{W}}_{input}} = \sqrt {{\left(\frac{{\partial \hat{\dot{W}}}}{{\partial {T_{evap}}}}\Delta {T_{evap}}\right)^2} + {\left(\frac{{\partial \hat{\dot{W}}}}{{\partial {T_{cond}}}}\Delta {T_{cond}}\right)^2}}, 
\label{eq:uncer_w_input}
\end{equation}

where $\Delta {\hat{\dot{W}}_{input}}$ is the uncertainty due to inputs at the map output, $\Delta {T_{evap}}$ is the uncertainty of evaporating temperature at input and $\Delta T_{cond}$ is the uncertainty of condensing temperature at input

\subsection{Uncertainty due to training data} \label{subsec:uncer_train}
Uncertainty due to training data is the uncertainty propagated to the map output from the training data through the map coefficients. This can be understood by considering the estimation of the map coefficients as a function of the training data as

\begin{equation}
\hat{ \vec {\beta}}  = g({T_{evap,train,1}},...,{T_{evap,train,n}},{T_{cond,train,1}},...,{T_{cond,train,n}},{\dot{W}_{train,1}},...,{\dot{W}_{train,n}}), 
\label{eq:beta_train}
\end{equation}

where n is the number of training data points. Through function $g$ and $\hat{ \vec {\beta}}$ in Eqn. (\ref{eq:beta_train}), as suggested in \cite{song:2013}, the uncertainty component due to training data is calculated

\begin{equation}
\Delta {\hat{\dot{W}}_{train}} = \sqrt{\begin{gathered}
  \Sigma_{j=1}^n\left(\Sigma _{i = 1}^m\left(\frac{{\partial \hat{\dot{W}}}}{{\partial {\beta _i}}}\frac{{\partial {\beta _i}}}{{\partial {T_{evap,train,j}}}}\right)\Delta {T_{evap,train,j}}\right)^2  \hfill \\
  +\Sigma_{j=1}^n\left(\Sigma _{i = 1}^m\left(\frac{{\partial \hat{\dot{W}}}}{{\partial {\beta _i}}}\frac{{\partial {\beta _i}}}{{\partial {T_{cond,train,j}}}}\right)\Delta {T_{cond,train,j}}\right)^2 \hfill \\
   +\Sigma_{j=1}^n\left(\Sigma _{i = 1}^m\left(\frac{{\partial \hat{\dot{W}}}}{{\partial {\beta _i}}}\frac{{\partial {\beta _i}}}{{\partial {\dot{W}_{,train,j}}}}\right)\Delta {\dot{W}_{train,j}}\right)^2 \hfill \\ 
\end{gathered}}, 
\label{eq:uncer_w_train}
\end{equation}

\blCom{difficult to grasp. not sure how much we can do about that...}

where $\Delta {\hat{\dot{W}}_{train}}$ is the uncertainty due to training data at the map output, $\Delta {T_{evap,train,j}}$ is the uncertainty of the evaporating temperature at the j$^{th}$ data point, $\Delta {T_{cond,train,j}}$ is the uncertainty of the condensing temperature at the j$^{th}$ data point, $\Delta {\dot{W}_{train,j}}$ is the uncertainty of the power consumption at the j$^{th}$ data point, and m is the number of coefficients in $\hat{\vec{\beta}}$.

\subsection{Uncertainty due to model random error} \label{subsec:uncer_model}

In linear regression, the random error between true model and actual system, $\varepsilon$ in Eqn. (\ref{eq:true_lin_model}) is assumed to be normally distributed around zero with some finite variance. This variance becomes part of the uncertainty of the uncertainty of the map output and can be presented in the form of confidence intervals. Statistic textbooks \cite{Montgomery:2005,Graybill:1994} illustrated that the confidence interval of the variance can be calculated as

\begin{equation}
\Delta {\hat{\dot{W}}_{model}} = {t_{n - m,1 - \alpha /2}}\sigma \sqrt {1 + {{\vec x}^T}{{({\mathbf{X}}_{train}^T{{\mathbf{X}}_{train}})}^{ - 1}}\vec x}
\label{eq:uncer_w_model}
\end{equation}

where $\Delta {\hat{\dot{W}}_{train}}$ is the uncertainty due to model random error at the map output.

One significant term in Eqn. (\ref{eq:uncer_w_model}) is ${\vec x^T}{({\mathbf{X}}_{train}^T{{\mathbf{X}}_{train}})^{ - 1}}\vec x$ which is the leverage of a regression model \cite{Atkinson:1987}. It estimates how deviated the current input vector to the map is relative to the training data of the regression model, and the magnitude of the leverage grows with the deviation. This helps to understand if the estimation is related to the training data and if (or ``how much'')the model is applicable at the current situation described by the input vector.

\subsection{Uncertainty due to output} \label{subsec:uncer_output}

Uncertainty of the map output should represent the probable range where the true value lies relative to the map output. However, since the map is built from data obtained from measured power consumption instead of true values of the power consumption, the uncertainty components of the map output propagated from other sources only estimate the uncertainty of the estimation with the measured power consumption. Another component of uncertainty must be introduced so that the map output uncertainty is the uncertainty to the true map output. This uncertainty component can be approximated with the uncertainty of the measured power consumption with its true values by

\begin{equation}
\Delta {\hat{\dot{W}}_{output}} = \frac{1}{n}\Sigma _{i = 1}^n\frac{{\Delta {{\dot{W}}_{train,i}}}}{{{{\dot{W}}_{train,i}}}} .
\label{eq:uncer_w_output}
\end{equation}

\subsection{Overall uncertainty} \label{subsec:overall_uncer}

The overall uncertainty of the map output is given by the square of the sum of all uncertainty components as

\begin{equation}
\Delta \hat{\dot{W}}= \sqrt {{{(\Delta {{\hat{\dot{W}}}_{input}})}^2} + {{(\Delta {{\hat{\dot{W}}}_{train}})}^2} + {{(\Delta {{\hat{\dot{W}}}_{model}})}^2} + {{(\Delta {{\hat{\dot{W}}}_{output}})}^2}} .
\label{eq:overall_uncer}
\end{equation}